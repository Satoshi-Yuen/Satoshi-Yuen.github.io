---
title: BGP——路由反射器
date: 2020-05-27 16:49:55
tags:
- 华为HCNP
- BGP
---
路由反射器（RR）：一种用于解决AS内部BGP路由传递问题的技术，通常应用于大型的BGP组网中。
&8195;介绍前先了解路由反射簇；
&8195;路由反射簇：路由反射器以及它的客户所构成的系统。
&8195;在一个路由反射簇中，路由器之间的对等体关系：
&8195;&8195;（1）客户机只需维护客户机与路由反射器（RR）之间的IBGP会话；
&8195;&8195;（2）路由反射器（RR）与路由反射器（RR）之间需要建立IBGP全互连；
&8195;&8195;（3）非客户机与非客户机之间需要建立IBGP全互连；
&8195;&8195;（4）路由反射器（RR）与非客户机之间需要建立IBGP全互连；

路由反射器在以下场景中才会反射BGP路由：
（1）若路由反射器从自己的非客户对等体学习到一条IBGP路由，则它会将该路由反射给所有客户；
（2）若路由反射器从自己的客户学习到一条IBGP路由，则它会将该路由反射给所有非客户，以及除了该客户之外的其他所有客户；
&8195;注意：华为的路由器支持关闭路由在客户之间的反射行为，在反射路由器上将反射行为关闭（BGP视图下的配置命令：undo reflect between-clients），则当反射路由器从客户学习到IBGP路由时，它只会把路由反射给非客户而不会反射给其他客户。
（3）当路由反射器执行路由反射时，它只将自己使用的、最优的BGP路由进行反射。

路由反射器的路由防环：
1、Originator_ID属性：
一个可选非传递属性，属性长度为32bit，格式与IPv4地址格式相同；
作用：用于防止在反射器和客户机或者非客户机之间产生环路。
工作原理：
&8195;（1）当一条BGP路由被路由反射给其他路由器时，如果该条路由已经携带了Originator_ID属性，则保留该属性，否则路由反射器就会为这条路由添加Originator_ID属性并将属性值设置为该路由在本地AS内的始发路由器的Router-ID；
&8195;（2）当路由器从BGP对等体接收到一条IBGP路由并且该路由携带的Originator_ID属性值与自己的BGP Router-ID相同时，说明曾经在自身始发的路由再一次被通告回来，那么路由器将会忽略这条路由的路由更新。
2、Cluster_List属性：
一个可选非传递属性，属性的值可变，可以包含一个或多个Cluster-ID（路由反射簇标识符）；
&8195;补充：Cluster-ID是一个可配置的、32bit的数值，缺省时为路由反射器的BGP Router-ID。
作用：用于防止AS内部的环路。
工作原理：
&8195;（1）当一条BGP路由被路由反射器执行反射时，如果该条路由已经存在Cluster_List属性，那么路由反射器将本地的Cluster-ID附加到路由的Cluster_List属性值之前，否则，路由反射器为它创建Cluster_List属性并将本地的Cluster-ID插入Cluster_List属性值中；
&8195;（2）当一台路由器接收到一条BGP路由后，发现该条路由携带者Cluster_List属性并且属性值中包含着自己的Cluster-ID时，说明曾经被自身反射出去的BGP路由再一次被通告回来，此时路由器就会忽略关于这条路由的路由更新。


