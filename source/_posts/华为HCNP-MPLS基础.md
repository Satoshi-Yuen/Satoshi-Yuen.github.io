---
title: 华为HCNP-MPLS基础
date: 2020-06-13 11:35:04
tags:
- 华为HCNP
- MPLS
---
MPLS：多协议标签交换，整合了IP及ATM的优势，提高了路由与数据的转发效率；要点：
&#8195;（1）多协议：MPLS技术能够支持多种网络协议，例如：单播IPv4、组播IPv4、单播IPv6、组播IPv6等；
&#8195;（2）标签交换：MPLS设备能够为IP报文增加标签信息，并且基于标签信息对报文进行转发，从而提高转发效率；
&#8195;（3）MPLS技术在原有IP报文的基础上增加MPLS标签头部，标签头部被压到报文的二层头部之后、三层头部（通常就是IP头部）之前；
&#8195;（4）典型应用：基于MPLS的VPN、基于MPLS的流量工程等。

MPLS术语：
（1）标签交换路由器（LSR）：指激活了MPLS标签交换功能的路由器；要点：
&#8195;&#8195;1）路由器范围：位于MPLS域内的交换机和ATM交换机；
&#8195;&#8195;2）作用：维护用于指导标签报文转发的信息，并且能够根据这些信息对标签报文进行处理；
（2）入站LSR（Ingress LSR）：指将IP报文进行处理，压入标签头部并生成标签报文的LSR；要点：
&#8195;&#8195;1）路由器范围：处于MPLS域的边界。
（3）中转LSR（Transit LSR）：指将标签报文进行处理，例如是执行标签置换等操作。
（4）出站LSR（Egress LSR）：指将标签报文中的标签头部移除，并将报文还原为IP报文的LSR。
（5）标签（Label）：当一个IP报文进入MPLS域时，MPLS标签头部被压到了报文的IP头部之前、二层头部之后。
（6）等价转发类（FEC）：指具有相同特征的报文，这些报文在LSR转发过程中采用相同的方式进行处理。
（7）标签交换路径（LSP）：指报文在MPLS域内的转发过程中所经过的路径，建立LSP分为动态和静态建立两种。
（8）标签分发协议：实现LSP的建立、维护及标签分发的协议，常见的标签分发协议：LDP、RSVP及MP-BGP。

MPLS的两个平面：
（1）控制平面：负责产生和维护路由信息以及标签信息；要点：
&#8195;&#8195;1）其中的路由协议模块用来传递路由信息、生成路由信息表；
&#8195;&#8195;2）其中的标签分发协议模块用来完成标签信息的交换，建立标签转发路径。
（2）数据平面：负责普通IP报文的转发以及带MPLS标签报文的转发，包括IP转发表和标签转发表；要点：
&#8195;&#8195;1）当收到普通IP报文时，如果是普通IP转发，则查找IP路由表转发；如果是需要标签转发，则按照标签转发表转发；
&#8195;&#8195;2）当收到带有标签的IP报文时，如果是需要标签转发，则根据标签转发表转发；如果需要转发到IP网络，则去掉标签后根据IP转发表转发。

MPLS标签：
&#8195;一个标签头部的长度固定为32bit，共包含4个字段：
&#8195;&#8195;（1）标签：用于存储标签值；
&#8195;&#8195;（2）EXP：试验性的字段，主要用于CoS；
&#8195;&#8195;（3）BoS：栈底位，若字段值为1，则表示本标签头部为标签栈底，意味着该标签头部后就是IP头部；若字段值为0，则表示本标签头部并非栈底
&#8195;&#8195;（4）TTL：用于防止当网络中出现环路时，标签报文被无限制转发。
&#8195;LSR对报文执行的MPLS标签处理动作主要有：
&#8195;&#8195;（1）压入（Push）：也称为插入操作，指一个IP报文进入MPLS网络时，入站LSR在报文的二层头部之后、IP头部之前压入标签；
&#8195;&#8195;（2）置换（Swap）：指在一个MPLS网络中，LSR转发标签报文时，将标签头部置换成下游LSR所分配的标签，当标签报文存在多层标签时，置换操作通常只对栈顶的标签进行；
&#8195;&#8195;（3）弹出（Pop）：指标签报文离开LSP时，出站LSR将标签报文的栈顶标签移除。
&#8195;两种封装模式：
&#8195;&#8195;（1）帧模式：直接在报文的二层头部和三层头部之间加一个MPLS标签头；
&#8195;&#8195;（2）信元模式

MPLS防环检测：
分为IGP环路检测机制、TTL环路检测两种；
在帧模式的MPLS中采用TTL环路检测；
信元模式的MPLS无TTL，采用LDP环路检测机制，LDP环路检测机制包括
&#8195;（1）LDP距离向量法：每个LSR在发送标签请求消息（标签映射消息）中，包含一个Path Vector TLV，并且入口（出口）LSR产生的路径长度值为1，并且把自己的LSR ID加到TLV的列表中，标签请求消息（标签映射消息）每经过一跳长度值加1；接收端LSR如果收到的标签请求消息（标签映射消息），发现长度值达到预先设定的最大值或者发现LSR ID列表中有自己的LSR ID，认为发现环路，发出通知消息，拒绝LSP的建立。
&#8195;（2）最大跳数法：每个LSR在发送标签请求消息（标签映射消息）中，包含一个hop count TLV，并且入口（出口）LSR产生的初始跳数值为，标签请求消息（标签映射消息）每经过一跳跳数值加1；接收端LSR如果在收到的标签请求消息中（标签映射消息），发现跳数值达到预先设定的最大值，认为发现环路，发出通知消息，拒绝LSP的建立。
