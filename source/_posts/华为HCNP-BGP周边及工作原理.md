---
title: 华为HCNP--BGP周边及工作原理
date: 2020-04-16 17:08:03
tags:
- 华为HCNP
- BGP
---
两类动态路由协议：
&#8195;1、IGP（内部网关协议）：能够帮助路由器发现并计算到达本AS内各个网段的路由，从而实现AS内部的数据互通。
&#8195;2、EGP（外部网关协议）：完成AS之间无环路的路由交互。
&#8195;&#8727;AS：自治系统，编号取值：1-65535
<!--more-->

BGP（边界网关协议）：
&#8195;（1）一种EGP协议，是增强的距离矢量路由协议，用于控制路由传播和选取最优路由；
&#8195;（2）定义多种路径属性用于描述路由和丰富的路由策略工具；
工作原理：
&#8195;BGP使用TCP作为传输层协议，在应用层上工作；
&#8195;1）BGP使用目的TCP端口179，两台互为对等体的BGP路由器首先会建立TCP连接，协商建立对等体关系；
&#8195;2）建立完对等体关系后，两者会同步双方的BGP路由表，这时候根据双方情况选择发送Update报文；如果出现路由需要更新时，也需要发送Update报文（只是发送增量更新或在需要时进行触发更新）；
&#8195;3）在对等体双方的状态区域稳定后，对等体会周期性地发送Keepalive报文了解对方的存活情况；

BGP的对等体关系类型：
BGP采用TCP作为传输层协议，两台路由器只要具备IP连通并且通过TCP179端口建立连接，即可完成对等体关系的建立，因此对等体关系可以跨平台建立。
&#8195;（1）EBGP对等体关系： 在位于不同的AS，两台BGP路由器建立的对等体关系；
&#8195;（2）IBGP对等体关系：在位于同一个AS，两台BGP路由器建立的对等体关系；

BGP报文类型：
&#8195;（1）Open报文：与对等体建立邻居关系；
&#8195;（2）Update报文：向其对等体通告路由信息，还能够用于撤销一条或多条BGP路由；
&#8195;（3）Keepalive报文：用于了解对等体的存活情况，BGP路由器会为对等体维护一个保活计时器，若计时器超时，BGP对等体关系需要被重新建立，Keepalive报文可刷新计时器，防止超时。BGP路由器周期性发送Keepalive报文的时间间隔缺省为1/3的保活计时器时间（180s），即60s。
&#8195;（4）Notification报文：当BGP检测到一个错误时，可以发送Notification报文来告知对等体；
